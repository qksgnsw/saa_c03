# 2. IAM

### 1. 정의

1. AWS 리소스에 대한 엑세스를 안전하게 제어할 수 있는 웹서비스
2. 해당 권한을 중앙에서 관리
3. 기능
   1. AWS 계정에 대한 공유 액세스
   2. 권한 세부화
   3. Amazon EC2에서 실행되는 애플리케이션을 위한 보안 AWS 리소스 액세스
   4. 멀티 팩터 인증(MFA)
   5. 아이덴티티 페더레이션: AWS 계정에 대한 임시 액세스 권한을 부여

### 2. 사용 사례

1. 다른 직무를 수행하는 경우
   1. 서비스 사용자
   2. 서비스 관리자
   3. IAM 관리자
2. AWS 리소스에 액세스할 권한이 있는 경우
   1. 인증은 ID 자격 증명을 사용하여 AWS에 로그인하는 방식입니다. 
   2. AWS 계정 루트 사용자나 IAM 사용자로 또는 IAM 역할을 수임하여 인증(AWS에 로그인)되어야 합니다.
   3. AWS프로그래밍 방식으로 액세스하는 경우, 자격 증명을 사용하여 요청에 암호화 방식으로 서명할 수 있는 소프트웨어 개발 키트 (SDK) 및 명령줄 인터페이스 (CLI) 를AWS 제공합니다. 
3. IAM 사용자로 로그인하는 경우
   1. 단일 개인 또는 애플리케이션에 대한 특정 권한을 가지고 있는 AWS 계정 내 자격 증명
4. IAM 역할을 맡을 경우
   1. 특정 권한을 가지고 있는 AWS 계정 계정 내 ID
5. 정책 및 권한을 생성하는 경우
   1. 신뢰 정책: 역할을 맡을 수 있는 보안 주체와 조건을 정의합니다. 신뢰 정책은 IAM 역할에 대해 특정한 유형의 리소스 기반 정책 유형입니다. 역할은 하나의 신뢰 정책만 가질 수 있습니다.
   2. 자격 증명 기반 정책(인라인 및 관리형): 이러한 정책은 해당 역할의 사용자가 수행할 수 있는 (또는 수행할 수 없도록 거부되는) 권한과 리소스 위치를 정의합니다.

### 3. 사용자

1. 정의
   1. AWS에서 생성하는 엔터티
   2. 실제 사용자, 또는 서비스를 나타낸다.
2. 구성
   1. 이름
   2. 자격 증명
3. 액세스 방법
   1. 콘솔 암호
   2. 액세스 키
   3. SSH 키
   4. 서버 인증서
4. MFA
   1. 사용자가 액세스 시 MFA 메너키즘의 고유 인증을 추가하여 보안 강화
   2. FIDO 보안 키
   3. 가상 MFA 디바이스
   4. 하드웨어 TOTP 토큰

### 4. 그룹

![그룹](./02/Relationship_Between_Entities_Example.diagram.png)

1. 정의
   1. 사용자의 집합
   2. 다수의 사용자들에 대한 권한을 더 쉽게 관리 가능

2. 특징
   1. 한 사용자 그룹에 여러 사용자가 포함될 수 있으며 한 사용자가 다중 사용자 그룹에 속할 수 있습니다.
   2. 사용자 그룹은 중첩될 수 없습니다. 즉, 사용자 그룹은 사용자만 포함할 수 있으며 다른 그룹은 포함할 수 없습니다.
   3. AWS 계정의 모든 사용자를 자동으로 포함하는 기본 사용자 그룹은 없습니다. 이러한 사용자 그룹이 필요한 경우 하나 만들어 새로운 사용자를 각각 해당 그룹에 할당해야 합니다.
   4. 그룹 수, 사용자가 멤버가 될 수 있는 그룹 수와 같이 AWS 계정에 있는 IAM 리소스의 수와 크기는 제한되어 있습니다.

### 5. 정책

1. 정의
   1. 자격 증명이나 리소스와 연결될 때 해당 권한을 정의하는 AWS의 객체입니다.
2. 유형
   1. [아이덴티티 기반 정책](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html#policies_id-based)
      1. 관리형 및 인라인 정책을 IAM 아이덴티티(사용자, 사용자가 속한 그룹 또는 역할)에 연결합니다.
      2. 자격 증명 기반 정책은 자격 증명에 권한을 부여합니다.
      3. 분류
         1. 관리형 정책: AWS 계정에 속한 다수의 사용자, 그룹 및 역할에 독립적으로 연결할 수 있는 자격 증명 기반 정책입니다. 두 가지 유형의 관리형 정책이 있습니다.
            1. AWS 관리형 정책 - AWS에서 생성 및 관리하는 관리형 정책입니다.
            2. 고객 관리형 정책 - 사용자가 자신의 AWS 계정에서 생성 및 관리하는 관리형 정책입니다. 고객 관리형 정책은 AWS 관리형 정책보다 정책에 대해 더욱 정밀하게 제어할 수 있습니다.
         2. **인라인 정책**
            1. 단일 사용자, 그룹 또는 역할에 직접 추가하는 정책입니다. 
            2. 인라인 정책은 정책과 자격 증명을 정확히 1대 1 관계로 유지합니다. 
            3. 이는 자격 증명을 삭제하면 삭제됩니다.
   2. [리소스 기반 정책](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html#policies_resource-based)
      1. 인라인 정책을 리소스에 연결합니다.
      2. 리소스 기반 정책의 가장 일반적인 예제는 Amazon S3 버킷 정책 및 IAM 역할 신뢰 정책입니다.
      3. 리소스 기반 정책은 정책에 지정된 보안 주체에 권한을 부여합니다. 보안 주체는 리소스와 동일한 계정 또는 다른 계정에 있을 수 있습니다.
   3. [권한 경계](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html#policies_bound)
      1. 관리형 정책을 IAM 엔터티(사용자 또는 역할)에 대한 권한 경계로 사용합니다.
      2. 해당 정책은 자격 증명 기반 정책을 통해 엔터티에 부여할 수 있는 최대 권한을 정의하지만, 권한을 부여하지는 않습니다.
      3. 권한 경계는 리소스 기반 정책을 통해 엔터티에 부여할 수 있는 최대 권한을 정의하지 않습니다.
   4. [Organizations SCP](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html#policies_scp)
      1. AWS Organizations 서비스 제어 정책(SCP)을 사용하여 조직 또는 조직 단위(OU)의 계정 멤버에 대한 최대 권한을 정의합니다.
      2. SCP는 자격 증명 기반 정책이나 리소스 기반 정책을 통해 계정 내 엔터티(사용자나 역할)에 부여하는 권한을 제한하지만, 권한을 부여하지는 않습니다.
   5. [액세스 제어 목록(ACL)](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html#policies_acl)
      1. ACL을 사용하여 ACL이 연결된 리소스에 액세스할 수 있는 다른 계정의 보안 주체를 제어합니다.
      2. ACL는 리소스 기반 정책과 비슷합니다.
      3. 다만 JSON 정책 문서 구조를 사용하지 않은 유일한 정책 유형입니다.
      4. ACL은 지정된 보안 주체에 권한을 부여하는 크로스 계정 권한 정책입니다.
      5. ACL은 동일 계정 내 엔터티에 권한을 부여할 수 없습니다.
   6. [세션 정책](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/access_policies.html#policies_session)
      1. AWS CLI 또는 AWS API를 사용하여 역할이나 페더레이션 사용자를 수임할 때 고급 세션 정책을 전달합니다.
      2. 세션 정책은 역할이나 사용자의 자격 증명 기반 정책을 통해 세션에 부여하는 권한을 제한합니다.
      3. 세션 정책은 생성된 세션에 대한 권한을 제한하지 않지만, 권한을 부여하지도 않습니다.

### 6. 역할

1. 정의
   1. 계정에 생성할 수 있는, 특정 권한을 지닌 IAM 자격 증명
   2. 권한 정책을 갖춘 AWS 자격 증명이라는 점에서 IAM 역할은 IAM 사용자와 유사
   3. But 역할은 한 사람과만 연관되지 않고 해당 역할이 필요한 사람이라면 누구든지 맡을 수 있어야 함

### 7. 요약

1. 사용자(User): 실제 사용자와 매핑, AWS 콘솔에 대한 패스워드를 가짐. 사용자는 그룹에 두는 것이 모범사례.
2. 그룹: 사용자만을 포함할 수 있으며 그룹은 포함할 수 없음.
3. 정책(Policy): 사용자나 그룹에게 권한을 알려주는 **json 문서**.
4. 역할(Role): AWS 서비스에 대한 권한을 주려고 할 때 역할을 만들어야 함.
5. 보안: 다중 인증 요소를 활성화하여 MFA등을 사용하게 해야하고, 강력한 비밀번호 정책을 활용.
6. AWS CLI: 커맨드라인 수준에서 AWS Services를 관리
7. AWS SDK: 프로그래밍 수준에서 AWS Services를 관리
8. Access Keys: CLI나 SDK 수준에서 AWS 서비스에 접근하게 해주는 키
9. Audit: IAM 대시보드 감사, 자격 증명 보고서를 만들어 사용자 관련 정보 모니터링, 액세스 관리자를 사용하여 최근 권한 사용 내역 모니터링.

### 8. 문제

1. 다음 중 IAM 역할의 올바른 정의?

- ❌ 다중 사용자 그룹에 속한 IAM 사용자
- ❌ IAM 사용자들을 위한 비밀번호 정책을 정의하는 IAM 개체
- ✅ AWS 서비스에 요청을 생성하기 위한 일련의 권한을 정의하고, AWS 서비스에 의해 사용될 IAM 개체
- ❌ 특정 행동 수행을 위해 IAM 사용자에게 할당된 권한

2. 다음 중 IAM 보안 도구에 해당되는 것은 무엇인가요?

- ✅ IAM 자격 증명 보고서
- ❌ IAM 루트 계정 관리자
- ❌ IAM 서비스 보고서
- ❌ IAM 보안 관리자

3. IAM 사용자에 대해 **잘못** 서술된 내용을 고르세요.

- ❌ IAM 사용자들은 다중 사용자 그룹에 속할 수 있다.
- ❌ IAM 사용자들이 사용자 그룹에 속할 필요는 없다.
- ❌ IAM 정책은 IAM 사용자에게 직접 연결될 수 있다.
- ✅ IAM 사용자들은 루트 계정 자격 증명을 통해 AWS 서비스에 액세스 한다.

4. 다음 중 IAM 모범 사례에 해당하는 것은?

- ❌ 한 사람에게 다수의 IAM 사용자 생성
- ✅ 루트 계정 사용하지 않기
- ❌ 자격 증명 공유하기
- ❌ MFA 비활성화

5. IAM 정책이란?

- ❌ AWS 계정들이 상호 작용하는 방법을 정의하는 일련의 정책
- ✅ AWS 서비스에 요청을 생성하기 위한 일련의 권한을 정의하며, IAM사용자, 사용자 그룹 및 IAM 역할에서 사용하게될 JSON 문서
- ❌ IAM 사용자들의 비밀 번호를 정의하는 일련의 정책
- ❌ 고객들이 AWS와 상호작용하는 방법을 보여주는, AWS에서 정의한 일련의 정책

6. IAM 권한에는 다음 중 어떤 원칙이 적용되어야 하는가

- ❌ 최대 권한 부여
- ❌ 요청시 더 많은 권한 부여
- ✅ 최소 권한 부여
- ❌ 루트 계정 권한 제한

7. 루트 계정 보안을 향상시키기 위해서는 어떤 작업을 수행해야 할까요?

- ❌ 루트 계정 권한 제거
- ❌ CLI에서만 액세스
- ❌ IAM 사용자를 생성하지 않고, 루트 계정으로만 AWS 계정에 액세스
- ✅ MFA 활성화

8. IAM 사용자 그룹은 IAM 사용자 및 기타 사용자 그룹을 포함할 수 있습니다.

- ❌ 참
- ✅ 거짓

9. IAM 정책은 하나 이상의 문장으로 구성됩니다. 다음 중 IAM 정책 내 문장의 구성 요소가 아닌 것을 고르세요.

- ❌ 효과
- ❌ 원칙
- ✅ 버전
- ❌ 조치
- ❌ 리소스